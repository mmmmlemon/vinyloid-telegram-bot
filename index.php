<?php

require_once "vendor/autoload.php";
require __DIR__ . '/token.php';
require __DIR__ . '/helpers.php';
// require __DIR__ . '/dbFunctions.php';
require __DIR__ . '/controllerFunctions.php';

try {
    
    // API –¢–æ–∫–µ–Ω
    $token = getTelegramBotAPIToken();

    // Telegram-–±–æ—Ç
    $bot = new \TelegramBot\Api\Client($token);

    // –û–ë–†–ê–ë–û–¢–ö–ê –ö–û–ú–ê–ù–î
    // –∫–æ–º–∞–Ω–¥–∞ start
    $bot->command('start', function ($message) use ($bot) {

         //–∑–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –ª–æ–≥
         $check = writeCommandLog($message, true);

         if($check){
            // –ø–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç
            $response = startCommand();
            // –æ—Ç–≤–µ—Ç
            $bot->sendMessage($message->getChat()->getId(), $response);
         } else {
             // –æ—Ç–≤–µ—Ç c –æ—à–∏–±–∫–æ–π
            $bot->sendMessage($message->getChat()->getId(), "‚ö† –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –∫–æ–º–∞–Ω–¥—ã –≤ –ª–æ–≥ ‚ö†");
         }

    });

    // –∫–æ–º–∞–Ω–¥–∞ help
    $bot->command('help', function ($message) use ($bot) {
        //–∑–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –ª–æ–≥
        $check = writeCommandLog($message, true);

        if($check){
            // –ø–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç
            $response = helpCommand();
            // –æ—Ç–≤–µ—Ç
            $bot->sendMessage($message->getChat()->getId(), $response);
         } else {
             // –æ—Ç–≤–µ—Ç c –æ—à–∏–±–∫–æ–π
            $bot->sendMessage($message->getChat()->getId(), "‚ö† –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –∫–æ–º–∞–Ω–¥—ã –≤ –ª–æ–≥ ‚ö†");
         }
    });

    // –∫–æ–º–∞–Ω–¥–∞ find
    $bot->command('find', function($message) use ($bot){ 
        //–∑–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –ª–æ–≥
        $check = writeCommandLog($message, true);

        if($check){
            $response = findCommand();
            $bot->sendMessage($message->getChat()->getId(),  $response, 'HTML');
        } else {
            $bot->sendMessage($message->getChat()->getId(),  "‚ö† –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –∫–æ–º–∞–Ω–¥—ã –≤ –ª–æ–≥ ‚ö†");
        }
    });

    // –∫–æ–º–∞–Ω–¥–∞ additem
    $bot->command('additem', function($message) use ($bot){ 
        //–∑–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –ª–æ–≥
        $check = writeCommandLog($message, true);

        if($check){
            $response = additemCommand();
            $bot->sendMessage($message->getChat()->getId(),  $response, 'HTML');
        } else {
            $bot->sendMessage($message->getChat()->getId(),  "‚ö† –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –∫–æ–º–∞–Ω–¥—ã –≤ –ª–æ–≥ ‚ö†");
        }
    });

    // –∫–æ–º–∞–Ω–¥–∞ deleteitem
    $bot->command('deleteitem', function($message) use ($bot){
        // –∑–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –ª–æ–≥
        $check = writeCommandLog($message, true);

        if($check){
            $response = deleteitemCommand($message->getChat()->getId());

            foreach($response as $deleteItem){
                $bot->sendMessage($message->getChat()->getId(), $deleteItem);    
            }
        } else {
            $bot->sendMessage($message->getChat()->getId(),  "‚ö† –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –∫–æ–º–∞–Ω–¥—ã –≤ –ª–æ–≥ ‚ö†");
        }
    });

    // –∫–æ–º–∞–Ω–¥–∞ showitems
    $bot->command('showitems', function($message) use ($bot){
        //–∑–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –ª–æ–≥
        $check = writeCommandLog($message, true);

        if($check){
            $response = showitemsCommand($message->getChat()->getId());
            $bot->sendMessage($message->getChat()->getId(),  $response, 'HTML');
        } else {
            $bot->sendMessage($message->getChat()->getId(),  "‚ö† –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –∫–æ–º–∞–Ω–¥—ã –≤ –ª–æ–≥ ‚ö†");
        }
    });

      // –∫–æ–º–∞–Ω–¥–∞ checklps
      $bot->command('checklps', function($message) use ($bot){
        $check = writeCommandLog($message, true);

        if($check){
            
            $id = $message->getChat()->getId();

            $notifications = checklpsCommand($id);

            $count = 0;
            $countOld = 0;

            if($notifications != false){

                $bot->sendMessage($id, "–ù–∞—á–∏–Ω–∞—é –ø–æ–∏—Å–∫ –ø–ª–∞—Å—Ç–∏–Ω–æ–∫ –ø–æ —Å–ø–∏—Å–∫—É... üîé\n\nüîΩ–ù–∏–∂—ë - –≤—Å—ë —á—Ç–æ —è –Ω–∞–π–¥—ÉüîΩ");  

                foreach($notifications as $notification){
                    $countOld = $count;
                    
                    // –ø–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å plastinka.com –∏ –≤—ã–≤–æ–¥–∏–º
                    $plastinkaResponse = generateProductList($notification, "plastinka", 0, true);
                    
                    if($plastinkaResponse != false)
                    $bot->sendMessage($id, "plastinka.com - <b>{$notification}</b>", 'HTML');  

                    if($plastinkaResponse != false){
                        // –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∏—à—ë–ª –±–µ–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
                        if($plastinkaResponse['keyboard'] === false){
                            $bot->sendMessage($id, $plastinkaResponse['messageProducts'], 'HTML', true);  
                        } 
                        // –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∏—à—ë–ª —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
                        else if($plastinkaResponse['keyboard'] === true){
                            $bot->sendMessage($id, $plastinkaResponse['messageProducts'], 'HTML', true, null, $plastinkaResponse['keyboardObject']);  
                        } else {
                            $bot->sendMessage($id, $plastinkaResponse);  
                        }
                        $count += 1;
                    } 

                    // –ø–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å vinylbox.ru
                    // –ø–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å plastinka.com –∏ –≤—ã–≤–æ–¥–∏–º
                    $vinylboxResponse = generateProductList($notification, "vinylbox", 0, true);

                    if($vinylboxResponse != false)
                    $bot->sendMessage($id, "vinylbox.ru - <b>{$notification}</b>", 'HTML');  

                    if($vinylboxResponse != false){
                        // –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∏—à—ë–ª –±–µ–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
                        if($vinylboxResponse['keyboard'] === false){
                            $bot->sendMessage($id, $vinylboxResponse['messageProducts'], 'HTML', true);  
                        } 
                        // –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∏—à—ë–ª —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
                        else if($vinylboxResponse['keyboard'] === true){
                            $bot->sendMessage($id, $vinylboxResponse['messageProducts'], 'HTML', true, null, $vinylboxResponse['keyboardObject']);  
                        } else {
                            $bot->sendMessage($id, $vinylboxResponse);  
                        }
                        $count += 1;
                    }

                    if($countOld === $count){
                        if($plastinkaResponse == false && $vinylboxResponse == false){
                            $bot->sendMessage($id, "<b>{$notification}</b>\n\n–ü–ª–∞—Å—Ç–∏–Ω–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.", 'HTML');
                        }    
                    }
                    
                }

                
            } else {
                $bot->sendMessage($id, "–ù–µ—Ç –ø–ª–∞—Å—Ç–∏–Ω–æ–∫ –∏–ª–∏ –∞—Ä—Ç–∏—Å—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏. –î–æ–±–∞–≤—å—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É /additem");  
            }

            if($count == 0 && $notifications != false){
                $bot->sendMessage($id, "–ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –ø–ª–∞—Å—Ç–∏–Ω–∫–∏ –∏–∑ —Å–ø–∏—Å–∫–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /find —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ üîé");  
            } else if ($count > 0 && $notifications != false){
                $bot->sendMessage($id, "üîº –≠—Ç–æ –≤—Å–µ —á—Ç–æ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ üîº");  
            }

            // // –ø–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            // $response = checklpsCommand($message->getChat()->getId());

            // // –≤—ã–≤–æ–¥–∏–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            // foreach($response as $msg){
                
            //     // –µ—Å–ª–∏ —ç—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            //     if(gettype($msg) == 'string'){
            //         $bot->sendMessage($message->getChat()->getId(), $msg, 'HTML', true, null);
            //     }

            //     // –µ—Å–ª–∏ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–ª–∞—Å—Ç–∏–Ω–∫–∞—Ö
            //     else if(gettype($msg) == 'array'){
            //         // –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π –∏–ª–∏ –±–µ–∑ –Ω–µ—ë
            //         if($msg['keyboard'] === false){
            //             $bot->sendMessage($message->getChat()->getId(), $msg['message'], 'HTML', true, null);
            //         } else {
            //             $bot->sendMessage($message->getChat()->getId(), $msg['message'], 'HTML', true,  null , $msg['keyboardObject']);
            //         }  
            //     }    
            // } 
        } else {
            $bot->sendMessage($message->getChat()->getId(), "‚ö† –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –∫–æ–º–∞–Ω–¥—ã –≤ –ª–æ–≥ ‚ö†");
        }
    });

    
    //–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∫–æ–ª–ª–±—ç–∫–∏
    $bot->on(function (\TelegramBot\Api\Types\Update $update) use ($bot) {

        // –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–ª–±—ç–∫–∏
        $callbackQuery = $update->getCallbackQuery();

        // –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–±—ç–∫–æ–≤, –µ—Å–ª–∏ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∑–Ω–∞—á–∏—Ç –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω callback
        if ($callbackQuery !== null) {

            //–∑–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –ª–æ–≥
            $check = writeCommandLog($callbackQuery->getMessage(), false);
            
            if($check){
                
                // –µ—Å–ª–∏ –∫–æ–ª–ª–±—ç–∫ –µ—Å—Ç—å, —Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫–µ
                $index = strpos($callbackQuery->getData(), '[');
                $indexEnd = strpos($callbackQuery->getData(), ']');
                $indexTwo = strpos($callbackQuery->getData(), '(');
                $indexTwoEnd = strpos($callbackQuery->getData(), ')');
                // —Å—Ç—Ä–∞–Ω–∏—Ü–∞
                $pageToShow = substr($callbackQuery->getData(), 0, $index);
                // —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞
                $textForSearch = substr($callbackQuery->getData(), $index+1, $indexEnd-2);   
                // —Å–∞–π—Ç
                $site = substr($callbackQuery->getData(), $indexTwo+1, $indexTwoEnd);   
                $site = str_replace(')', '', $site);

                // –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–≤–µ–¥—ë–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
                $response = generateProductList($textForSearch, $site, $pageToShow, true);

                $id = $callbackQuery->getMessage()->getChat()->getId();

                // –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∏—à—ë–ª –±–µ–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
                if($response['keyboard'] === false){
                    if($response['messageHeader'] != null){
                        $bot->sendMessage($id, $response['messageHeader']);
                    }
                    $bot->sendMessage($id, $response['messageProducts'], 'HTML', true);  
                } 
                // –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∏—à—ë–ª —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
                else if($response['keyboard'] === true){
                    if($response['messageHeader'] != null){
                        $bot->sendMessage($id, $response['messageHeader']);
                    }
                    $bot->sendMessage($id, $response['messageProducts'], 'HTML', true, null, $response['keyboardObject']);  
                } else {
                    $bot->sendMessage($id, $response);  
                }

                $bot->answerCallbackQuery(
                    $callbackQuery->getId()
                );
            } else {
                $bot->sendMessage($message->getChat()->getId(),  "‚ö† –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –∫–æ–º–∞–Ω–¥—ã –≤ –ª–æ–≥ ‚ö†");
            }
        }
        // –µ—Å–ª–∏ –Ω–µ—Ç –∫–æ–ª–ª–±—ç–∫–æ–≤, –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        else { 
            // –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            $message = $update->getMessage();

            // –ø–æ–ª—É—á–µ–Ω–∏–µ id —á–∞—Ç–∞
            $id = $message->getChat()->getId();

            // –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã
            $latestCommand = getLatestCommand($id);

            // –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è —Å –≤–≤–µ–¥—ë–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∞–Ω–Ω–æ–π –≤ –ª–æ–≥ –∫–æ–º–∞–Ω–¥—ã
            // –µ—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω—è—è –∫–æ–º–∞–Ω–¥–∞ –±—ã–ª–∞ /find, —Ç–æ –∏—â–µ–º –ø–ª–∞—Å—Ç–∏–Ω–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–≤–µ–¥—ë–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
            if($latestCommand === "/find"){
                // –∑–∞–ø–∏—Å—å –∫–æ–º–∞–Ω–¥—ã NULL –≤ –ª–æ–≥
                $check = writeCommandLog($message, false);
                
                if($check){
            
                    // –ø–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å plastinka.com –∏ –≤—ã–≤–æ–¥–∏–º
                    $plastinkaResponse = generateProductList($message->getText(), "plastinka", 0, true);

                    if($plastinkaResponse != false){
                        // –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∏—à—ë–ª –±–µ–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
                        if($plastinkaResponse['keyboard'] === false){
                            if($plastinkaResponse['messageHeader'] != null){
                                $bot->sendMessage($id, $plastinkaResponse['messageHeader']);
                            }
                            $bot->sendMessage($id, $plastinkaResponse['messageProducts'], 'HTML', true);  
                        } 
                        // –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∏—à—ë–ª —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
                        else if($plastinkaResponse['keyboard'] === true){
                            if($plastinkaResponse['messageHeader'] != null){
                                $bot->sendMessage($id, $plastinkaResponse['messageHeader']);
                            }
                            $bot->sendMessage($id, $plastinkaResponse['messageProducts'], 'HTML', true, null, $plastinkaResponse['keyboardObject']);  
                        } else {
                            $bot->sendMessage($id, $plastinkaResponse);  
                        }
                    }

                    // –ø–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å vinylbox.ru
                    // –ø–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å plastinka.com –∏ –≤—ã–≤–æ–¥–∏–º
                    $vinylboxResponse = generateProductList($message->getText(), "vinylbox", 0, true);

                    if($vinylboxResponse != false){
                        // –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∏—à—ë–ª –±–µ–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
                        if($vinylboxResponse['keyboard'] === false){
                            if($vinylboxResponse['messageHeader'] != null){
                                $bot->sendMessage($id, $vinylboxResponse['messageHeader']);
                            }
                            $bot->sendMessage($id, $vinylboxResponse['messageProducts'], 'HTML', true);  
                        } 
                        // –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∏—à—ë–ª —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
                        else if($vinylboxResponse['keyboard'] === true){
                            if($vinylboxResponse['messageHeader'] != null){
                                $bot->sendMessage($id, $vinylboxResponse['messageHeader']);
                            }
                            $bot->sendMessage($id, $vinylboxResponse['messageProducts'], 'HTML', true, null, $vinylboxResponse['keyboardObject']);  
                        } else {
                            $bot->sendMessage($id, $vinylboxResponse);  
                        }
                    }

                    if($vinylboxResponse == false && $plastinkaResponse == false){
                        $bot->sendMessage($id, "–ü–æ –∑–∞–ø—Ä–æ—Å—É –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –ø–ª–∞—Å—Ç–∏–Ω–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /find —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ üîé");  
                    }


                } else {
                    $bot->sendMessage($message->getChat()->getId(),  "‚ö† –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –∫–æ–º–∞–Ω–¥—ã –≤ –ª–æ–≥ ‚ö†");
                }
            } 
            
            else if($latestCommand === "/additem"){
                // –∑–∞–ø–∏—Å—å –∫–æ–º–∞–Ω–¥—ã NULL –≤ –ª–æ–≥
                $check = writeCommandLog($message, false);

                if($check){
                    // –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–≤–µ–¥—ë–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
                    $response = addNotification($message->getChat()->getId(), $message->getText());
                    $bot->sendMessage($message->getChat()->getId(), $response, 'HTML');
                }
            }

            else if ($latestCommand === "/deleteitem"){

                // –∑–∞–ø–∏—Å—å –∫–æ–º–∞–Ω–¥—ã NULL –≤ –ª–æ–≥
                $check = writeCommandLog($message, false);

                if($check){
                    // –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–≤–µ–¥—ë–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
                    $response = deleteNotification($message->getChat()->getId(), $message->getText());
                    $bot->sendMessage($message->getChat()->getId(), $response, 'HTML');
                }
         
            }
            
            else {
                // –∑–∞–ø–∏—Å—å –∫–æ–º–∞–Ω–¥—ã NULL –≤ –ª–æ–≥
                writeCommandLog($message, false);
                $bot->sendMessage($id, '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É. –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ /help');
            }

        }
    
    }, function () {
        return true;
    });

    $bot->run();

} catch (\TelegramBot\Api\Exception $e) {
    $e->getMessage();

}

?>